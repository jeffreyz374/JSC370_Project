"0","# datatable2 - datatable with child rows"
"0","datatable2 <- function(x, vars = NULL, opts = NULL, ...) {"
"0","  "
"0","  names_x <- names(x)"
"0","  if (is.null(vars)) stop(""'vars' must be specified!"")"
"0","  pos <- match(vars, names_x)"
"0","  if (any(map_chr(x[, pos], typeof) == ""list""))"
"0","    stop(""list columns are not supported in datatable2()"")"
"0","  "
"0","  pos <- pos[pos <= ncol(x)] + 1"
"0","  rownames(x) <- NULL"
"0","  if (nrow(x) > 0) x <- cbind(' ' = '&oplus;', x)"
"0",""
"0","  # options"
"0","  opts <- c("
"0","    opts, "
"0","    list("
"0","      columnDefs = list("
"0","        list(visible = FALSE, targets = c(0, pos)),"
"0","        list(orderable = FALSE, className = 'details-control', targets = 1),"
"0","        list(className = 'dt-left', targets = 1:3),"
"0","        list(className = 'dt-right', targets = 4:ncol(x))"
"0","      )"
"0","  ))"
"0","  "
"0","  datatable("
"0","    x, "
"0","    ...,"
"0","    escape = -2,"
"0","    options = opts,"
"0","    callback = JS(.callback2(x = x, pos = c(0, pos)))"
"0","  )"
"0","}"
"0",""
"0",".callback2 <- function(x, pos = NULL) {"
"0","  "
"0","  part1 <- ""table.column(1).nodes().to$().css({cursor: 'pointer'});"""
"0","  "
"0","  part2 <- .child_row_table2(x, pos = pos)"
"0","  "
"0","  part3 <- "
"0","  """
"0","   table.on('click', 'td.details-control', function() {"
"0","    var td = $(this), row = table.row(td.closest('tr'));"
"0","    if (row.child.isShown()) {"
"0","      row.child.hide();"
"0","      td.html('&oplus;');"
"0","    } else {"
"0","      row.child(format(row.data())).show();"
"0","      td.html('&ominus;');"
"0","    }"
"0","  });"""
"0","  "
"0","  paste(part1, part2, part3)"
"0","} "
"0",""
"0",".child_row_table2 <- function(x, pos = NULL) {"
"0","  "
"0","  names_x <- paste0(names(x), "":"")"
"0","  text <- """
"0","  var format = function(d) {"
"0","    text = '<div><table >' + "
"0","  """
"0",""
"0","  for (i in seq_along(pos)) {"
"0","    text <- paste(text, glue::glue("
"0","        ""'<tr>' +"
"0","          '<td>' + '{names_x[pos[i]]}' + '</td>' +"
"0","          '<td>' + d[{pos[i]}] + '</td>' +"
"0","        '</tr>' + "" ))"
"0","  }"
"0",""
"0","  paste0(text,"
"0","    ""'</table></div>'"
"0","      return text;};"""
"0","  )"
"0","}"
